<!DOCTYPE html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Login Form登陆框 </title>
    <LINK REL=StyleSheet HREF="css/style.css" TYPE="text/css" MEDIA=screen>
    <meta name="robots" content="noindex,follow"/>
    <style type="text/css">
        .login {
            /* border: 1px solid red; */
            height: 300px;
            width: 300px;
            margin: auto;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .login-help {
            /* border: 1px solid red; */
            height: 300px;
            width: 300px;
            margin: auto;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;

        }
    </style>
</head>
<body>
<div class="container">
    <div class="login">
        <h1>登录</h1>
        <select id="selection">
            <option value="0">员工</option>
            <option value="1">用户</option>
        </select>
        <br>
        <p><input type="text" id="txtAccount" name="login" value="" placeholder="员工ID或用户ID"></p>
        <p><input type="password" id="txtPwd" name="password" value="" placeholder="员工电话或业主密码"></p>
        <p class="remember_me">
            <label>
                <input type="checkbox" name="remember_me"     checked id="remember_me">
                记住账号
            </label>
        </p>
        <p class="submit"><input type="button" id="btnRegister"  value="登录"></p>
    </div>
</div>
</body>
<script type="text/javascript" src="js/jquery-3.2.1.js"></script>
<script type="text/javascript" src="js/layer/layer.js"></script>
<script type="text/javascript" src="assets/js/jquery-1.8.1.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/jquery.base64.js"></script>
<script type="text/javascript">

    $(function () {
        $('#btnRegister').click(function () {
            if ($('#selection').val() == 0) {
                if ($('#txtAccount').val() == '' || $('#txtPwd').val() == '') {
                    layer.msg('请输入完整信息');
                    return;
                }
                $.post('stafflogin.do',
                    {
                        account: $('#txtAccount').val(),
                        password: $('#txtPwd').val()
                    },
                    function (data) {
                        console.log(data);
                        if (data.code == 200) {
                            // console.log(data.result)
                            sessionStorage.setItem('user', JSON.stringify(data.result))
                            layer.msg(data.msg, {icon: 1, time: 2000}, function () {
                                // console.log($('#selection').val())
                                location.href = "indexstaff.html";
                            })
                        } else {
                            alert(data.msg);
                        }
                    },
                    'json')
                setCookie();
                //sdad
            } else if ($('#selection').val() == 1) {
                if ($('#txtAccount').val() == '' || $('#txtPwd').val() == '') {
                    layer.msg('请输入完整信息');
                    return;
                }

                $.post('login.do',
                    {
                        account: $('#txtAccount').val(),
                        password: $('#txtPwd').val()
                    },
                    function (data) {
                        console.log(data);
                        if (data.code == 200) {
                            sessionStorage.setItem('user', JSON.stringify(data.result))
                            layer.msg(data.msg, {icon: 1, time: 2000}, function () {
                                // console.log($('#selection').val())
                                location.href = "indexuser.html";
                            })
                        } else {
                            alert(data.msg);
                        }
                    }, 'json')
                setCookie();
            }
        })

        function setCookie() {
            var loginCode = $("#txtAccount").val(); //获取用户名信息
            var pwd = $("#txtPwd").val(); //获取登陆密码信息
            console.log(1)
            console.log($("input[type='checkbox']").is(':checked'))


            if ($("input[type='checkbox']").is(':checked')) {
                console.log(1)
                var date = new Date();
                date.setTime(date.getTime() + 60 * 1000);//只能这么写，60表示60秒钟
                console.log("cookie过期时间：" + date);
                $.cookie("login_code", loginCode)
                $.cookie("pwd", $.base64.encode(pwd))

            } else {
                $.cookie("login_code", null);
                $.cookie("pwd", null);
            }
            console.log(1)
        }

        $('#txtAccount').change(function () {
                if ($('#txtAccount').val() == $.cookie("login_code")) {
                    console.log("取cook")
                    console.log($.base64.decode($.cookie("pwd")))
                    $('#txtPwd').val($.base64.decode($.cookie("pwd")))
                }
            }
        )


    })


</script>
</html>

